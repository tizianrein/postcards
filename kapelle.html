<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <script data-goatcounter="https://digitalfabricationtum.goatcounter.com/count"
      async src="//gc.zgo.at/count.js"></script>

    <style>
      /* =======================
         OVERLAY
      ======================= */
      #overlay {
        position: absolute;
        inset: 0;
        z-index: 10;
        pointer-events: none;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        font-family: Georgia, serif;
        overflow: hidden;
      }

      /* =======================
         SCAN INSTRUCTIONS
      ======================= */
      #scan-instructions {
        background: rgba(0, 0, 0, 0.6);
        padding: 20px;
        border-radius: 15px;
        color: white;
        transition: opacity 0.5s;
        position: relative;
        z-index: 30;
      }

      .instruction-title {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .instruction-hint {
        font-size: 16px;
        color: #ddd;
      }

      /* =======================
         GREETINGS
      ======================= */
      #greetings {
        position: absolute;
        bottom: 10%;
        width: 100%;
        opacity: 0;
        transition: opacity 1s ease-in-out;
        z-index: 30;
      }

      .festive-text {
        position: relative;
        font-size: 40px;
        font-weight: bold;
        background: linear-gradient(to right, #ff3333, #ff6b6b);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: float 3s ease-in-out infinite;
        z-index: 1;
      }

      /* âœ¨ WHITE GLOW BEHIND TEXT */
      .festive-text::before {
        content: attr(data-text);
        position: absolute;
        inset: 0;
        white-space: pre-line;
        text-align: center;
        color: white;
        z-index: -1;
        filter: blur(8px);
        opacity: 0.9;
        pointer-events: none;
      }

      @keyframes float {
        0% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
        100% { transform: translateY(0); }
      }

      /* =======================
         SNOW
      ======================= */
      .snowflake {
        position: absolute;
        top: -10px;
        color: white;
        pointer-events: none;
        z-index: 5;
        animation: fall linear forwards;
      }

      @keyframes fall {
        to {
          transform: translateY(110vh);
        }
      }

      /* =======================
         UTILITIES
      ======================= */
      .hidden {
        opacity: 0 !important;
        pointer-events: none;
      }

      .visible {
        opacity: 1 !important;
      }
    </style>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const target = document.querySelector("#my-target");
        const scanInstructions = document.querySelector("#scan-instructions");
        const greetings = document.querySelector("#greetings");
        const overlay = document.querySelector("#overlay");

        let snowInterval = null;

        function createSnowflake() {
          const flake = document.createElement("div");
          flake.className = "snowflake";
          flake.textContent = "â„";
          flake.style.left = Math.random() * 100 + "vw";
          flake.style.fontSize = 10 + Math.random() * 12 + "px";
          flake.style.opacity = Math.random();
          flake.style.animationDuration = 2 + Math.random() * 3 + "s";
          overlay.appendChild(flake);

          setTimeout(() => flake.remove(), 5000);
        }

        function startSnow() {
          if (!snowInterval) {
            snowInterval = setInterval(createSnowflake, 100);
          }
        }

        function stopSnow() {
          clearInterval(snowInterval);
          snowInterval = null;
          document.querySelectorAll(".snowflake").forEach(f => f.remove());
        }

        target.addEventListener("targetFound", () => {
          scanInstructions.classList.add("hidden");
          greetings.classList.add("visible");
          startSnow();
        });

        target.addEventListener("targetLost", () => {
          scanInstructions.classList.remove("hidden");
          greetings.classList.remove("visible");
          stopSnow();
        });
      });
    </script>
  </head>

  <body>
    <!-- UI OVERLAY -->
    <div id="overlay">
      <div id="scan-instructions">
        <div class="instruction-title">Scanne das Bild der Kapelle</div>
        <div class="instruction-hint">
          Warte bitte ein wenig und bewege das Handy nur langsam
        </div>
        <div style="margin-top:10px; font-size:24px;">ðŸ“·</div>
      </div>

      <div id="greetings">
        <div class="festive-text"
          data-text="Frohe Weihnachten!
und einen gelungenen Start ins neue Jahr!">
          Frohe Weihnachten!<br>
          <span style="font-size:24px;">
            und einen gelungenen Start ins neue Jahr!
          </span>
        </div>
      </div>
    </div>

    <!-- AR SCENE -->
    <a-scene
      mindar-image="imageTargetSrc: https://cdn.jsdelivr.net/gh/tizianrein/postcards@main/targets_kapelle.mind;
                    filterMinCF:0.0005; filterBeta:0.001; missTolerance:50;"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false">

      <a-assets>
        <a-asset-item
          id="avatarModel"
          src="https://cdn.jsdelivr.net/gh/tizianrein/postcards@refs/heads/main/chapel_2.gltf">
        </a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-entity id="my-target" mindar-image-target="targetIndex: 0">
        <a-gltf-model
          src="#avatarModel"
          position="0 0 -0.1"
          scale="50 50 50"
          animation__rotation="property: rotation; to: 0 0 360;
                               dur: 20000; loop: true; easing: linear">
        </a-gltf-model>
      </a-entity>
    </a-scene>
  </body>
</html>
